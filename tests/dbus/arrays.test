Packages: gio-2.0
D-Bus

Program: client

[DBus (name = "org.example.Test")]
interface Test : Object {
	public abstract string[] test_property { owned get; set; }

	public abstract int[] test_int (int[] i, out int[] j) throws IOError;
	public abstract string[] test_string (string[] s, out string[] t) throws IOError;
}

void main () {
	// client
	Test test = Bus.get_proxy_sync (BusType.SESSION, "org.example.Test", "/org/example/test");

	int[] j, k;
	k = test.test_int ({ 42 }, out j);
	assert (j.length == 1 && j[0] == 23);
	assert (k.length == 1 && k[0] == 11);

	string[] t, u;
	u = test.test_string ({ "hello" }, out t);
	assert (t.length == 1 && t[0] == "world");
	assert (u.length == 1 && u[0] == "vala");

	test.test_property = { "hello" };
	t = test.test_property;
	assert (t.length == 1 && t[0] == "hello");
}

Program: server

[DBus (name = "org.example.Test")]
class Test : Object {
	public string[] test_property { owned get; set; }

	public int[] test_int (int[] i, out int[] j) {
		assert (i.length == 1 && i[0] == 42);
		j = { 23 };
		return { 11 };
	}

	public string[] test_string (string[] s, out string[] t) {
		assert (s.length == 1 && s[0] == "hello");
		t = { "world" };
		return { "vala" };
	}
}

Application app;

void client_exit (Pid pid, int status) {
	// client finished, terminate server
	assert (status == 0);
	app.quit ();
}

void main () {
	var conn = Bus.get_sync (BusType.SESSION);
	conn.register_object ("/org/example/test", new Test ());

	// try to register service in session bus
	app = new Application ("org.example.Test");

	// server ready, spawn client
	Pid client_pid;
	Process.spawn_async (null, { "test", "/dbus/arrays/client" }, null, SpawnFlags.DO_NOT_REAP_CHILD, null, out client_pid);
	ChildWatch.add (client_pid, client_exit);

	app.run ();
}
